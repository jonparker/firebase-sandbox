<html>
  <head>
    <script src='https://cdn.firebase.com/v0/firebase.js'></script>
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js'></script>
    <script type='text/javascript' src='https://cdn.firebase.com/v0/firebase-auth-client.js'></script>
    <script type='text/javascript' src='http://ajax.aspnetcdn.com/ajax/knockout/knockout-2.2.1.js'></script>
	
	<script type="text/javascript">
	
        var page = {};
        
        var viewModel = function()
        {
        	var self = this;
            self.email = ko.observable();
            self.password = ko.observable();
            self.message = ko.observable();
            self.isloggedIn = ko.observable(false);
            self.LogginStatus = ko.computed(function()
            {
            	return this.isloggedIn() ? "Logged in" : "Not logged in";
            }, this);
            
            self.login = function()
            {
                page.authClient.login('password', { email: this.email(), password: this.password() });
            };
            self.facebookLogin = function()
            {
                page.authClient.login('facebook');
            };
            self.logout = function()
            {
                page.authClient.logout();
            };
            self.saveMessage = function(text)
            {
                //page.firebase.child('text').set({ 'message': this.message() });
            };
            self.messages = ko.observableArray();
        };
		        
		$(document).ready(function()
		{
			var firebase = new Firebase('https://petitionm.firebaseio.com/');
			var authClient = new FirebaseAuthClient(firebase, function(error, data) {
			  if (error) {
				// an error occurred while attempting login
				page.viewModel.isloggedIn(false);

				console.log(error);
			  } else if (data) {
				// user authenticated with Firebase
				console.log('User ID: ' + data.id + ', Provider: ' + data.provider);
				page.viewModel.isloggedIn(true);
			  } else {
				// user is logged out
			  }
			});

			page.firebase.child('Petitions').on('child_added', function(snapshot) 
				{

				}
			);
			
			page.authClient = authClient;
			page.firebase = firebase;
            page.viewModel = new viewModel();

            ko.applyBindings(page.viewModel);
		});
		
	</script>
  </head>
<body>
	<div id="messages">
	</div>
	
	<h4>Login status: <span data-bind="value: LogginStatus" /></h4>
	<br/>
	<label for="username">Email</label>
	<input type="text" value="email" data-bind="value: email" />
	<br/>
	<label for="password">Password</label>
	<input type="text" value="password" data-bind="value: password" />
	<br/>

	<input type="button" value="Login" data-bind="click: login" />
    <input type="button" value="Facebook Login" data-bind="click: facebookLogin" />
	<input type="button" value="Logout" data-bind="click: logout" />
	<input type="text" id="message" data-bind="value: message" />
	<input type="button" value="Save" data-bind="click: saveMessage" />
</body>
</html>
